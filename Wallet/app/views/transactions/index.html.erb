<div class="flex_container">
  <div style="flex: 1;">
    <div class="transactions-container">
      <% grouped_transactions = @transactions.group_by { |transaction| format_transaction_date(transaction.date) } %>

      <% grouped_transactions.each do |date, transactions| %>
        <p class="transaction-date"><%= date %></p>

        <ul>
          <% transactions.reverse_each do |transaction| %>
            <% amount_display = transaction.amount.to_i == transaction.amount ? transaction.amount.to_i : transaction.amount %>
            <% amount_class = amount_display.positive? ? 'positive-amount' : '' %>

            <li>
              <span><%= add_spaces_to_name(transaction.name, amount_display) %></span>
              <div class="amount-wrapper">
                <%= button_to 'Видалити', transaction_path(transaction), method: :delete, data: { confirm: 'Are you sure you want to delete this transaction?' }, class: 'delete-button' %>
                <span class="<%= amount_class %>"><%= format_amount_with_decimals(amount_display) %>₴</span>
              </div>
            </li>
          <% end %>
        </ul>
      <% end %>
    </div>
  </div>

<div style="flex: 1;">
  <%= form_with(model: @new_transaction, url: transactions_path, id: 'new_transaction') do |form| %>
    <div class="input-group">
      <div class="sign-toggle">
        <button type="button" id="toggle-sign-button">👆</button>
        <%= form.text_field :amount, type: 'text', step: 'any', id: 'amount-field', placeholder: '0₴' %>
      </div>
    </div>

    <div>
      <%= form.text_field :name, placeholder: '👌 призначення' %>
    </div>

    <div>
      <%= form.date_field :date %>
    </div>

    <div>
      <%= form.submit 'Додати' %>
    </div>
  <% end %>
</div>

<script>
  function setupSignToggle() {
    const toggleSignButton = document.getElementById('toggle-sign-button');
    const amountField = document.getElementById('amount-field');

    function updateButtonEmoji() {
      const amountValue = amountField.value;
      if (amountValue.startsWith('-')) {
        toggleSignButton.innerText = '👇';
      } else {
        toggleSignButton.innerText = '👆';
      }
    }

    toggleSignButton.addEventListener('click', function() {
      const amountValue = amountField.value;
      if (amountValue.startsWith('-')) {
        amountField.value = amountValue.substring(1); // Remove the minus sign
      } else {
        amountField.value = '-' + amountValue; // Add the minus sign
      }
      updateButtonEmoji();
    });

    amountField.addEventListener('input', updateButtonEmoji);
    updateButtonEmoji(); // Update the button emoji initially based on the amount value
  }

  setupSignToggle(); // Call the setupSignToggle function immediately
</script>
